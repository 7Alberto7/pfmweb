{% extends "MIWIntranetBundle:Default:base.html.twig" %}

{% block commonup%}

    <ul class="breadcrumb" style="margin-bottom: 5px;">
        <li><a href="{{path('intranet_home')}}">WePlay</a></li>
        <li><a href="{{path('intranet_games')}}">Partidos</a></li>
        <li class="active">Mostrar Partidos</li>
    </ul>

{% endblock%}

{% block sidecontent %}
    
    <div class="row margin-top-20">
        <div class="col-xs-12">
            <div class="well bs-component">
                <legend>Filtrar</legend>
                
             </div>
        </div>
    </div>  
        
{% endblock%}
    
{% block maincontent %}
      
    {% if gamesCount > 0 %}
        <blockquote class="margin-top-20">
            <p>Actualmente participas en {{ gamesCount }} partidos.</p>
        </blockquote>
        
            <div class="bs-component">
                <h3>Hoy</h3>
            
                {% for game in gamesToday %}
            
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="form-group" data-game="{{ game.id }}">                        
                                <h4 class="list-group-item-heading">
                                    {{ game.gameDate | date("d/m/Y h:m") }}
                                    {{ game.sport.name }}
                                    {{ game.center.name }}, {{ game.center.address.city }}
                                </h4>                                
                                <img class="btn-suscribe" src="{{ asset('bundles/framework/images/blue_picto_more.gif') }}" />
                                <a href="{{path('intranet_games_show', {'id': game.id})}}"><img src="{{ asset('bundles/framework/images/grey_magnifier.png') }}" /></a>
                                <span class="badge">Plazas Disponibles: {{ game.numPlayers - game.players | length }}</span>                       
                            </div>
                        </div>
                    </div>
            
                {% endfor %}
                       
            <h3>Ma√±ana</h3>
            
                {% for game in gamesTomorrow %}

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="form-group" data-game="{{ game.id }}">                        
                                <h4 class="list-group-item-heading">
                                    {{ game.gameDate | date("d/m/Y h:m") }}
                                    {{ game.sport.name }}
                                    {{ game.center.name }}, {{ game.center.address.city }}
                                </h4>                                
                                <img class="btn-suscribe" src="{{ asset('bundles/framework/images/blue_picto_more.gif') }}" />
                                <a href="{{path('intranet_games_show', {'id': game.id})}}"><img src="{{ asset('bundles/framework/images/grey_magnifier.png') }}" /></a>
                                <span class="badge">Plazas Disponibles: {{ game.numPlayers - game.players | length }}</span>                       
                            </div>
                        </div>
                    </div>

                {% endfor %} 
            
            <h3>Esta Semana</h3>
            
                {% for game in gamesThisWeek %}

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="form-group" data-game="{{ game.id }}">                        
                                <h4 class="list-group-item-heading">
                                    {{ game.gameDate | date("d/m/Y h:m") }}
                                    {{ game.sport.name }}
                                    {{ game.center.name }}, {{ game.center.address.city }}
                                </h4>                                
                                <img class="btn-suscribe" src="{{ asset('bundles/framework/images/blue_picto_more.gif') }}" />
                                <a href="{{path('intranet_games_show', {'id': game.id})}}"><img src="{{ asset('bundles/framework/images/grey_magnifier.png') }}" /></a>
                                <span class="badge">Plazas Disponibles: {{ game.numPlayers - game.players | length }}</span>                       
                            </div>
                        </div>
                    </div>

                {% endfor %}
             </div>
        
    {% else %}

        <blockquote class="margin-top-20">
            <p>No tienes partidos.</p>
        </blockquote>
        <div class="col-xs-7 margin-top-20">
            <a href="{{path('intranet_create_game')}}">Organizate uno.</a>
        </div>
    
    {% endif %}

    <script>
        $(document).ready(function() {
            $('.btn-suscribe').on('click', function() {
                    $.ajax({
                        method: "GET",
                        url: "{{path('intranet_ajax_suscribe_game')}}",
                        dataType: "json",
                        data: {
                            game: $(this).parent().getAttribute('data-game')
                        },
                        success: function(data) {
                            // modify image and available
                            //var plant = document.getElementById('strawberry-plant');
                            //var fruitCount = plant.getAttribute('data-fruit');
                            //$(selector).val(value);
                            //$('.badge').val(data.available);                    
                            if(data.code)                                
                                $(this).css({"src":"{{ asset('bundles/framework/images/blue_picto_less.gif') }}"});
                            else 
                                $(this).css({"src":"{{ asset('bundles/framework/images/blue_picto_more.gif') }}"});
                        }
                    });
             });
        });
    </script>
    
{% endblock %}